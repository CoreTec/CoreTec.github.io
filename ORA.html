<html>
<head>
    <title>ORA</title>    
    <script src='orastuff.js'></script>
	<LINK href="orastuffstyle.css" rel="stylesheet" type="text/css">
	<script>
		function findGetParameter(parameterName) {
			var result = null,
				tmp = [];
			location.search
				.substr(1)
				.split("&")
				.forEach(function (item) {
				  tmp = item.split("=");
				  if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
				});
			return result;
		}
		var playerName = findGetParameter("player");
		var mapName = findGetParameter("map");
		var playing = findGetParameter("playing");
		var openForPlayers = findGetParameter("open");
		var mode = findGetParameter("mode");
		var serverName = findGetParameter("server");
		var hasPlayers = findGetParameter("hasplayers");
		var _getDisplayFields = findGetParameter("display");
		if(_getDisplayFields)
			var getDisplayFields = _getDisplayFields.split(",");
				
		var tru = function(){return true};
		
		var fnc = and_F(
			mode ? ORA_filterLookForMode(mode.toLowerCase()) : tru,
			openForPlayers ? ORA_filterStandard : tru,
			playing ? ORA_filterCurrentlyPlayed : tru,			
			playerName ? ORA_filterLookForPlayer(playerName.toLowerCase()) : tru,
			serverName ? ORA_filterLookForServer(serverName.toLowerCase()) : tru,
			hasPlayers ? ORA_filterHasPlayers : tru
		);	
		
		var textFields={
			mods: "MOD",
			name: "Server Name",
			"protected": "Passworded",
			stateText: "Status",
			location: "Location",
			mapLink: "Map Name",
			players: "Players",
			maxplayers: "Max Players",
			spectators: "Spectators",
			duration: "Play Time (approx.)",
			clients: "Player Nickames",
			playersText: "Players",
			modeDesc: "Mod"
		}
		
		if(!_getDisplayFields){
			var displayFields = ["mods","name","protected","stateText","mapLink","players","maxplayers","spectators","duration","clients"];
		}
		else{
			var displayFields = getDisplayFields;
		}	
		
		function ORA_work(elementid){
			var element = document.getElementById(elementid);
			ORA_prepData(fnc, function(dt){
				//MAP IS SO SPESHUL
				dt = dt.filter(mapName ? ORA_filterLookForMap(mapName.toLowerCase()) : tru)
				//debugger;
				element.innerHTML = "";
				var text = "<table class='responstable'><tr class='ora_headerrow'>"
				for(var k=0; k<displayFields.length; k++)
					text+="<td class='header_"+displayFields[k]+"'>"+(textFields[displayFields[k]]||displayFields[k])+"</td>";
				text+="</tr>";
				for(var i=0; i<dt.length; i++){
					text+="<tr class='responseRow'>";
					
					for(var k=0; k<displayFields.length; k++){
						text+="<td class='display_"+displayFields[k]+"'>"+
							(Array.isArray(dt[i][displayFields[k]])?dt[i][displayFields[k]].join(", "):
								(dt[i][displayFields[k]]?dt[i][displayFields[k]].toString():"")
							)
							+"</td>";
					}				
					
					text+="</tr>";
				}
				element.innerHTML = text;
			});
		}
	</script>
</head>
<body onload='ORA_work("raservergrid");setInterval(function(){ORA_work("raservergrid")},30*1000)' style='background:transparent'>
	<div id='raservergrid'></div>
</body>
</html>