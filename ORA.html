<html>
<head>
    <title>ORA</title>    
    <script src='orastuff.js'></script>
	<LINK href="orastuffstyle.css" rel="stylesheet" type="text/css">
	<script>
		function findGetParameter(parameterName) {
			var result = null,
				tmp = [];
			location.search
				.substr(1)
				.split("&")
				.forEach(function (item) {
				  tmp = item.split("=");
				  if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
				});
			return result;
		}
		var playerName = findGetParameter("player");
		var mapName = findGetParameter("map");
		var playing = findGetParameter("playing");
		var openForPlayers = findGetParameter("open");
		var mode = findGetParameter("mode");
		var serverName = findGetParameter("server");
				
		var tru = function(){return true};
		
		var fnc = and_F(
			mode ? ORA_filterLookForMode(mode.toLowerCase()) : tru,
			openForPlayers ? ORA_filterStandard : tru,
			playing ? ORA_filterCurrentlyPlayed : tru,			
			playerName ? ORA_filterLookForPlayer(playerName.toLowerCase()) : tru,
			serverName ? ORA_filterLookForServer(serverName.toLowerCase()) : tru
		);	
		
		if(!mode){
			var displayFields = ["mods","name","protected","stateText","map","players","maxplayers","spectators","duration","clients"];
			var textFields = ["MODE","Server Name","protected","Status","Map Name","Players","Max Players","Spectators","Play Time","Player Nickames"];
		}
		else{
			var displayFields = ["name","protected","stateText","map","players","maxplayers","spectators","duration","clients"];
			var textFields = ["Server Name","protected","Status","Map Name","Players","Max Players","Spectators","Play Time","Player Nickames"];
		}	
		
		function ORA_work(elementid){
			var element = document.getElementById(elementid);
			ORA_prepData(fnc, function(dt){
				//MAP IS SO SPESHUL
				dt = dt.filter(mapName ? ORA_filterLookForMap(mapName.toLowerCase()) : tru)
				//debugger;
				element.innerHTML = "";
				var text = "<table class='responstable'><tr class='ora_headerrow'>"
				for(var k=0; k<displayFields.length; k++)
					text+="<td class='header_"+displayFields[i]+"'>"+textFields[k]+"</td>";
				text+="</tr>";
				for(var i=0; i<dt.length; i++){
					text+="<tr class='responseRow'>";
					
					for(var k=0; k<displayFields.length; k++){
						//map is SPESHUL
						if(displayFields[k]=="map")
							text+="<td class='display_map'>"+dt[i].map.title+"</td>";
						else
							text+="<td class='display_"+displayFields[k]+"'>"+
								(Array.isArray(dt[i][displayFields[k]])?dt[i][displayFields[k]].join(", "):
									(dt[i][displayFields[k]]?dt[i][displayFields[k]].toString():"")
								)
								+"</td>";
					}				
					
					text+="</tr>";
				}
				element.innerHTML = text;
			});
		}
	</script>
</head>
<body onload='ORA_work("raservergrid");setInterval(function(){ORA_work("raservergrid")},15*1000)'>
	<div id='raservergrid'></div>
</body>
</html>